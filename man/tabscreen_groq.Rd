% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tabscreen_groq.r
\name{tabscreen_groq}
\alias{tabscreen_groq}
\title{Title and abstract screening with Groq API models using function-like behavior via system messages}
\usage{
tabscreen_groq(
  data,
  prompt,
  studyid,
  title,
  abstract,
  ...,
  model = "llama3-70b-8192",
  role = "user",
  tools = NULL,
  tool_choice = NULL,
  top_p = 1,
  time_info = TRUE,
  token_info = TRUE,
  api_key = get_api_key_groq(),
  max_tries = 16,
  max_seconds = NULL,
  is_transient = .groq_is_transient,
  backoff = NULL,
  after = NULL,
  rpm = 10000,
  reps = 1,
  seed_par = NULL,
  progress = TRUE,
  decision_description = FALSE,
  messages = TRUE,
  incl_cutoff_upper = NULL,
  incl_cutoff_lower = NULL,
  force = FALSE
)
}
\arguments{
\item{data}{Dataset containing the titles and abstracts.}

\item{prompt}{Prompt(s) to be added before the title and abstract.}

\item{studyid}{Unique Study ID. If missing, this is generated
automatically.}

\item{title}{Name of the variable containing the title information.}

\item{abstract}{Name of variable containing the abstract information.}

\item{...}{Further argument to pass to the request body.}

\item{model}{Character string with the name of the completion model. Can take
multiple Groq models. Default = \code{"llama3-70b-8192"}.
Find available models at \url{https://console.groq.com/docs/models}.}

\item{role}{Character string indicate the role of the user. Default is \code{"user"}.}

\item{tools}{List of function definitions for tool calling. Default behavior is set based on \code{decision_description} parameter.
For detailed responses, the function uses tools that include detailed description capabilities.}

\item{tool_choice}{Specification for which tool to use. Default behavior is set based on \code{decision_description} parameter.
For simple responses uses "inclusion_decision_simple", for detailed responses uses "inclusion_decision".}

\item{top_p}{'An alternative to sampling with temperature, called nucleus sampling,
where the model considers the results of the tokens with top_p probability mass.
So 0.1 means only the tokens comprising the top 10\% probability mass are considered.
We generally recommend altering this or temperature but not both.' (Groq). Default is 1.}

\item{time_info}{Logical indicating whether the run time of each
request/question should be included in the data. Default = \code{TRUE}.}

\item{token_info}{Logical indicating whether the number of prompt and completion tokens
per request should be included in the output data. Default = \code{TRUE}. When \code{TRUE},
the output object will include price information of the conducted screening.}

\item{api_key}{Numerical value with your personal API key. Find at
\url{https://console.groq.com/keys}. Set with
\code{Sys.setenv(GROQ_KEY = "your-api-key")} or use \code{\link[=get_api_key_groq]{get_api_key_groq()}}.}

\item{max_tries, max_seconds}{'Cap the maximum number of attempts with
\code{max_tries} or the total elapsed time from the first request with
\code{max_seconds}. If neither option is supplied (the default), \code{\link[httr2:req_perform]{httr2::req_perform()}}
will not retry'.}

\item{is_transient}{'A predicate function that takes a single argument
(the response) and returns \code{TRUE} or \code{FALSE} specifying whether or not
the response represents a transient error'.}

\item{backoff}{'A function that takes a single argument (the number of failed
attempts so far) and returns the number of seconds to wait'.}

\item{after}{'A function that takes a single argument (the response) and
returns either a number of seconds to wait or \code{NULL}, which indicates
that a precise wait time is not available that the \code{backoff} strategy
should be used instead'.}

\item{rpm}{Numerical value indicating the number of requests per minute (rpm)
available for the specified api key.}

\item{reps}{Numerical value indicating the number of times the same
question should be sent to Groq's API models. This can be useful to test consistency
between answers. Default is \code{1}.}

\item{seed_par}{Numerical value for a seed to ensure that proper,
parallel-safe random numbers are produced.}

\item{progress}{Logical indicating whether a progress line should be shown when running
the title and abstract screening in parallel. Default is \code{TRUE}.}

\item{decision_description}{Logical indicating whether to include detailed descriptions
of decisions. Default is \code{FALSE}.}

\item{messages}{Logical indicating whether to print messages embedded in the function.
Default is \code{TRUE}.}

\item{incl_cutoff_upper}{Numerical value indicating the probability threshold
for which a studies should be included. Default is 0.5, which indicates that
titles and abstracts that Groq's API model has included more than 50 percent of the times
should be included.}

\item{incl_cutoff_lower}{Numerical value indicating the probability threshold
above which studies should be check by a human. Default is 0.4, which means
that if you ask Groq's API model the same questions 10 times and it includes the
title and abstract 4 times, we suggest that the study should be check by a human.}

\item{force}{Logical argument indicating whether to force the function to use more than
10 iterations. This argument is developed to avoid the conduct of wrong and extreme sized screening.
Default is \code{FALSE}.}
}
\value{
An object of class \code{"groq"}. The object is a list containing the following
components:
\item{answer_data_aggregated}{dataset with the summarized, probabilistic inclusion decision
for each title and abstract across multiple repeated questions (only when reps > 1).}
\item{answer_data}{dataset with all individual answers.}
\item{price_dollar}{numerical value indicating the total price (in USD) of the screening.}
\item{price_data}{dataset with prices across all models used for screening.}
\item{error_data}{dataset with failed requests (only included if errors occurred).}
\item{run_date}{date when the screening was conducted.}
}
\description{
This function supports the conduct of title and abstract screening with Groq API models in R.
Specifically, it allows the user to draw on Groq-hosted models (e.g., Llama 3 / 3.1 variants, Mixtral/Mistral, Gemma, DeepSeek, Qwen, and fine-tuned models).
The function allows to run title and abstract screening across multiple prompts and with
repeated questions to check for consistency across answers. All of which can be done in parallel.
The function draws on the newly developed function calling which is called via the
tools argument in the request body. This is the main different between \code{\link[=tabscreen_gpt.tools]{tabscreen_gpt.tools()}}
and \code{\link[=tabscreen_gpt.original]{tabscreen_gpt.original()}}. Function calls ensure more reliable and consistent responses to ones
requests. See \href{https://osf.io/preprints/osf/yrhzm}{Vembye, Christensen, Mølgaard, and Schytt. (2025)}
for guidance on how adequately to conduct title and abstract screening with Groq models.
}
\note{
The \code{answer_data_aggregated} data (only present when reps > 1) contains the following mandatory variables:
\tabular{lll}{
\bold{studyid} \tab \code{integer} \tab indicating the study ID of the reference. \cr
\bold{title} \tab \code{character} \tab indicating the title of the reference. \cr
\bold{abstract} \tab \code{character}   \tab indicating the abstract of the reference. \cr
\bold{promptid} \tab \code{integer} \tab indicating the prompt ID. \cr
\bold{prompt} \tab \code{character} \tab indicating the prompt. \cr
\bold{model} \tab \code{character}   \tab indicating the specific model used. \cr
\bold{question} \tab \code{character} \tab indicating the final question sent to Groq's API models. \cr
\bold{top_p} \tab \code{numeric}  \tab indicating the applied top_p. \cr
\bold{incl_p} \tab \code{numeric}  \tab indicating the probability of inclusion calculated across multiple repeated responses on the same title and abstract. \cr
\bold{final_decision_gpt} \tab \code{character} \tab indicating the final decision reached by model - either 'Include', 'Exclude', or 'Check'. \cr
\bold{final_decision_gpt_num}  \tab \code{integer}  \tab indicating the final numeric decision reached by model - either 1 or 0. \cr
\bold{longest_answer}  \tab \code{character} \tab indicating the longest response obtained
across multiple repeated responses on the same title and abstract. Only included if the detailed function
is used. See 'Examples' below for how to use this function. \cr
\bold{reps}  \tab \code{integer}  \tab indicating the number of times the same question has been sent to Groq's API models. \cr
\bold{n_mis_answers} \tab \code{integer} \tab indicating the number of missing responses. \cr
}
\if{html}{\out{<br>}}
The \code{answer_data} data contains the following mandatory variables:
\tabular{lll}{
\bold{studyid} \tab \code{integer} \tab indicating the study ID of the reference. \cr
\bold{title} \tab \code{character} \tab indicating the title of the reference. \cr
\bold{abstract} \tab \code{character}   \tab indicating the abstract of the reference. \cr
\bold{promptid} \tab \code{integer} \tab indicating the prompt ID. \cr
\bold{prompt} \tab \code{character} \tab indicating the prompt. \cr
\bold{model} \tab \code{character}   \tab indicating the specific model used. \cr
\bold{iterations} \tab \code{numeric} \tab indicating the number of times the same question has been sent to Groq's API models. \cr
\bold{question} \tab \code{character} \tab indicating the final question sent to Groq's API models. \cr
\bold{top_p}  \tab \code{numeric} \tab indicating the applied top_p. \cr
\bold{decision_gpt}  \tab \code{character} \tab indicating the raw decision - either \code{"1", "0", "1.1"} for inclusion, exclusion, or uncertainty, respectively. \cr
\bold{detailed_description}  \tab \code{character} \tab indicating detailed description of the given decision made by Groq's API models.
Only included if the detailed function is used. See 'Examples' below for how to use this function. \cr
\bold{decision_binary}  \tab \code{integer} \tab indicating the binary decision,
that is 1 for inclusion and 0 for exclusion. 1.1 decision are coded equal to 1 in this case. \cr
\bold{prompt_tokens}  \tab \code{integer} \tab indicating the number of prompt tokens sent to the server for the given request. \cr
\bold{completion_tokens}  \tab \code{integer} \tab indicating the number of completion tokens sent to the server for the given request. \cr
\bold{run_time}  \tab \code{numeric} \tab indicating the time it took to obtain a response from the server for the given request. \cr
\bold{n} \tab \code{integer} \tab indicating request ID.  \cr
}
\if{html}{\out{<br>}}
If any requests failed to reach the server, the object contains an
error data set (\code{error_data}) having the same variables as \code{answer_data}
but with failed request references only.\if{html}{\out{
<br>
}}


The \code{price_data} data contains the following variables:
\tabular{lll}{
\bold{model} \tab \code{character} \tab model name. \cr
\bold{input_price_dollar} \tab \code{integer} \tab price for all prompt/input tokens for the correspondent model. \cr
\bold{output_price_dollar}  \tab \code{integer} \tab price for all completion/output tokens for the correspondent model. \cr
\bold{price_total_dollar} \tab \code{integer} \tab total price for all tokens for the correspondent model. \cr
}

Find current token pricing at \url{https://console.groq.com/docs/pricing}.
}
\examples{
\dontrun{

# Make sure GROQ_KEY is set
Sys.setenv(GROQ_KEY = "your-api-key")

prompt <- "Is this study about a Functional Family Therapy (FFT) intervention?"

tabscreen_groq(
  data = filges2015_dat[1:2,],
  prompt = prompt,
  studyid = studyid,
  title = title,
  abstract = abstract,
  model = "llama3-70b-8192",
  max_tries = 2
  )

 # Get detailed descriptions of the decisions by using the
 # decision_description option. See example below.
 tabscreen_groq(
   data = filges2015_dat[1:2,],
   prompt = prompt,
   studyid = studyid,
   title = title,
   abstract = abstract,
   model = "llama3-70b-8192",
   decision_description = TRUE,
   max_tries = 2
 )
}
}
\references{
Vembye, M. H., Christensen, J., MÃ¸lgaard, A. B., & Schytt, F. L. W. (2024)
\emph{GPT API Models Can Function as Highly Reliable Second Screeners of Titles and Abstracts in Systematic Reviews:
A Proof of Concept and Common Guidelines} \url{https://osf.io/preprints/osf/yrhzm}
}
